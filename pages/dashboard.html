<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Principal - AgroTechNova</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../public/css/base.css">
</head>
<body>

  <div class="container">
    <!-- Header con navegación unificada -->
    <header>
      <div class="header-content">
        <img src="../images/logo.png" alt="Logo AgroTechnova" class="logo">
        <h1>🏠 Panel Principal</h1>
        <div class="user-info">
          <span id="usuarioNombre">Usuario</span>
          <button onclick="cerrarSesion()" class="btn-logout">Cerrar Sesión</button>
        </div>
      </div>
      <nav>
        <a href="dashboard.html" class="active">Dashboard</a>
        <a href="proyectos.html">Proyectos</a>
        <a href="usuarios.html">Usuarios</a>
        <a href="agendaReuniones.html">Agenda</a>
      </nav>
    </header>

    <!-- Bienvenida -->
    <section style="background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h2 style="color: #2e7d32; margin-bottom: 10px;">¡Bienvenido de nuevo! 👋</h2>
      <p style="color: #666;">Nos alegra tenerte de nuevo en AgroTechNova</p>
    </section>

    <!-- Funcionalidades Disponibles -->
    <section style="background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h2 style="color: #2e7d32; margin-bottom: 20px;">🚀 Funcionalidades Disponibles</h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="dashboard-card" onclick="window.location.href='usuarios.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-users fa-3x" style="color: #2e7d32; margin-bottom: 15px;"></i>
          <h3 style="color: #2e7d32; margin-bottom: 10px;">Gestión de Usuarios</h3>
          <p style="color: #666; font-size: 14px;">Administra usuarios, roles y permisos del sistema</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='proyectos.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-project-diagram fa-3x" style="color: #2e7d32; margin-bottom: 15px;"></i>
          <h3 style="color: #2e7d32; margin-bottom: 10px;">Gestión de Proyectos</h3>
          <p style="color: #666; font-size: 14px;">Crea y administra proyectos, fases e hitos</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='agendaReuniones.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-calendar-check fa-3x" style="color: #2e7d32; margin-bottom: 15px;"></i>
          <h3 style="color: #2e7d32; margin-bottom: 10px;">Agenda de Reuniones</h3>
          <p style="color: #666; font-size: 14px;">Programa y gestiona reuniones del equipo</p>
        </div>
      </div>

      <h3 style="color: #2e7d32; margin-top: 30px; margin-bottom: 15px; border-top: 2px solid #e8f5e9; padding-top: 20px;">📊 Gestión Financiera y Recursos (Sprint 3)</h3>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
        <div class="dashboard-card" onclick="irARecursos()" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-tools fa-3x" style="color: #f57c00; margin-bottom: 15px;"></i>
          <h3 style="color: #f57c00; margin-bottom: 10px;">Recursos</h3>
          <p style="color: #666; font-size: 14px;">Gestiona recursos, materiales y equipos por proyecto</p>
        </div>
        
        <div class="dashboard-card" onclick="irAPresupuestos()" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-dollar-sign fa-3x" style="color: #f57c00; margin-bottom: 15px;"></i>
          <h3 style="color: #f57c00; margin-bottom: 10px;">Presupuestos</h3>
          <p style="color: #666; font-size: 14px;">Administra presupuestos y controla gastos</p>
        </div>
        
        <div class="dashboard-card" onclick="irAGastos()" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-receipt fa-3x" style="color: #f57c00; margin-bottom: 15px;"></i>
          <h3 style="color: #f57c00; margin-bottom: 10px;">Gastos</h3>
          <p style="color: #666; font-size: 14px;">Registra y monitorea gastos del proyecto</p>
        </div>
      </div>
    </section>

    <!-- Mensaje Institucional -->
    <section style="background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%); padding: 30px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); color: white; text-align: center;">
      <h2 style="margin-bottom: 15px;">💡 Innovación para el campo</h2>
      <p style="margin-bottom: 10px; line-height: 1.6;">En AgroTechNova impulsamos el desarrollo agroindustrial mediante tecnología, asesoría y proyectos sostenibles que buscan mejorar la productividad y el bienestar de las comunidades rurales.</p>
      <p style="line-height: 1.6;">Nuestro equipo de expertos está listo para ayudarte a planificar, gestionar y optimizar tus proyectos agroindustriales.</p>
    </section>

  </div>

  <style>
    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
  </style>

  <script>
    // Obtener datos del usuario desde localStorage
    const nombreUsuario = localStorage.getItem('nombreUsuario') || 'Usuario';
    const rolUsuario = localStorage.getItem('rolUsuario') || 'productor';
    
    document.getElementById('usuarioNombre').textContent = nombreUsuario;

    function cerrarSesion() {
      // Llamar al endpoint de logout
      fetch('/api/auth/logout', {
        method: 'POST',
        credentials: 'include'
      }).then(() => {
        localStorage.removeItem('nombreUsuario');
        localStorage.removeItem('emailUsuario');
        localStorage.removeItem('rolUsuario');
        window.location.href = 'login.html';
      }).catch(() => {
        // Aunque falle, limpiar localStorage y redirigir
        localStorage.removeItem('nombreUsuario');
        localStorage.removeItem('emailUsuario');
        localStorage.removeItem('rolUsuario');
        window.location.href = 'login.html';
      });
    }

    // Funciones de navegación para Sprint 3
    async function irARecursos() {
      const proyectoId = await obtenerPrimerProyecto();
      if (proyectoId) {
        window.location.href = `recursos.html?proyecto_id=${proyectoId}`;
      } else {
        alert('No tienes proyectos disponibles. Por favor crea un proyecto primero.');
        window.location.href = 'proyectos.html';
      }
    }

    async function irAPresupuestos() {
      const proyectoId = await obtenerPrimerProyecto();
      if (proyectoId) {
        window.location.href = `presupuestos.html?proyecto_id=${proyectoId}`;
      } else {
        alert('No tienes proyectos disponibles. Por favor crea un proyecto primero.');
        window.location.href = 'proyectos.html';
      }
    }

    async function irAGastos() {
      const proyectoId = await obtenerPrimerProyecto();
      if (proyectoId) {
        window.location.href = `gastos.html?proyecto_id=${proyectoId}`;
      } else {
        alert('No tienes proyectos disponibles. Por favor crea un proyecto primero.');
        window.location.href = 'proyectos.html';
      }
    }

    async function obtenerPrimerProyecto() {
      try {
        const response = await fetch('/api/projects');
        if (response.ok) {
          const data = await response.json();
          if (data.projects && data.projects.length > 0) {
            return data.projects[0].id;
          }
        }
      } catch (error) {
        console.error('Error al obtener proyectos:', error);
      }
      return null;
    }
  </script>

</body>
</html>
